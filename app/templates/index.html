{% extends "base.html" %}
{% block title %}DS-PAL - Search Datasets{% endblock %}
{% block content %}
<section>
    <h1>Find & Analyze Datasets</h1>
    <p>Search across Kaggle, data.gov, UCI ML Repository, and HuggingFace for public datasets.</p>

    <form hx-post="/api/search"
          hx-target="#search-results"
          hx-indicator="#search-spinner">
        <fieldset role="group">
            <input type="search"
                   name="query"
                   placeholder="e.g., air quality in California"
                   required
                   minlength="2"
                   aria-label="Search datasets">
            <button type="submit">Search</button>
        </fieldset>
    </form>
</section>

{% if upload_error is defined and upload_error %}
<div class="error-message" role="alert">{{ upload_error }}</div>
{% endif %}

<section>
    <p style="text-align: center; color: var(--pico-muted-color);">&mdash; or upload your own &mdash;</p>
    <form id="upload-form"
          action="/api/dataset/upload"
          method="post"
          enctype="multipart/form-data">
        <fieldset role="group">
            <input type="file"
                   id="upload-file"
                   name="file"
                   accept=".csv,.json,.xlsx,.xls,.parquet"
                   aria-label="Upload a dataset file"
                   required>
            <button type="submit" id="upload-btn" disabled>Upload &amp; Preview</button>
        </fieldset>
        <small style="color: var(--pico-muted-color);">CSV, Excel, JSON, or Parquet &middot; max {{ max_file_size_mb }} MB</small>
    </form>
</section>

<section id="search-results">
    <!-- HTMX swaps search results here -->
</section>

<div id="search-spinner" class="htmx-indicator">
    <p aria-busy="true">Searching datasets...</p>
</div>

<!-- Dataset Preview Modal -->
<dialog id="preview-modal">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="document.getElementById('preview-modal').close()"></button>
            <h3 id="modal-title">Dataset Preview</h3>
        </header>
        <div id="modal-content">
            <!-- HTMX swaps modal preview content here -->
        </div>
        <div id="modal-spinner" class="htmx-indicator">
            <p aria-busy="true">Loading preview...</p>
        </div>
    </article>
</dialog>
{% endblock %}
