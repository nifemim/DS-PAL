{% extends "base.html" %}
{% block title %}DS-PAL - Search Datasets{% endblock %}
{% block body_attrs %}data-page="home"{% endblock %}
{% block content %}
<section>
    <h1>Find & Analyze Datasets</h1>
    <p>Search across Kaggle, data.gov, UCI ML Repository, and HuggingFace for public datasets.</p>

    <form hx-post="/api/search"
          hx-target="#search-results"
          hx-indicator="#search-spinner">
        <fieldset role="group">
            <input type="search"
                   name="query"
                   placeholder="e.g., air quality in California"
                   required
                   minlength="2"
                   aria-label="Search datasets">
            <button type="submit">Search</button>
        </fieldset>
    </form>
</section>

{% if upload_error is defined and upload_error %}
<div class="error-message" role="alert">{{ upload_error }}</div>
{% endif %}

<section style="text-align: center;">
    <p style="color: var(--pico-muted-color);">&mdash; or &mdash;</p>
    <form id="upload-form"
          action="/api/dataset/upload"
          method="post"
          enctype="multipart/form-data">
        <input type="file"
               id="upload-file"
               name="file"
               accept=".csv,.json,.xlsx,.xls,.parquet"
               style="display: none;"
               aria-label="Upload a dataset file">
        <button type="button" id="upload-pick-btn" class="secondary"
                onclick="document.getElementById('upload-file').click()">
            Upload a file
        </button>
        <span id="upload-filename" style="margin-left: 0.5rem; color: var(--pico-muted-color); font-size: 0.85rem;"></span>
        <button type="submit" id="upload-btn" style="display: none;">Upload &amp; Analyze</button>
        <br>
        <small style="color: var(--pico-muted-color);">CSV, Excel, JSON, or Parquet &middot; max {{ max_file_size_mb }} MB</small>
    </form>
</section>

<section id="search-results">
    <!-- HTMX swaps search results here -->
</section>

<div id="search-spinner" class="htmx-indicator">
    {% include "partials/skeleton.html" %}
</div>

<!-- Dataset Preview Modal -->
<dialog id="preview-modal">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="document.getElementById('preview-modal').close()"></button>
            <h3 id="modal-title">Dataset Preview</h3>
        </header>
        <div id="modal-content">
            <!-- HTMX swaps modal preview content here -->
        </div>
        <div id="modal-spinner" class="htmx-indicator">
            {% include "partials/skeleton.html" %}
        </div>
    </article>
</dialog>
{% endblock %}
